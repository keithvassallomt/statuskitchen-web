---
import Button from './Button.astro';
---

<nav
    class='fixed top-4 left-0 right-0 z-50 flex justify-end md:justify-center px-4'
>
    <div
        id='navbar-container'
        class='bg-surface-card/90 dark:bg-surface-card-dark/90 backdrop-blur-xl border border-white/20 dark:border-white/10 rounded-2xl shadow-2xl shadow-black/5 px-2 py-2 flex flex-col md:flex-row md:items-center gap-1 sm:gap-6 w-auto transition-all duration-300 overflow-hidden'
    >
        <div
            class='flex items-center justify-end md:justify-between w-full md:w-auto'
        >
            <!-- Logo -->
            <a
                href='/'
                class='hidden md:flex items-center gap-2 pl-3 hover:opacity-80 transition-opacity whitespace-nowrap'
            >
                <img
                    src='/logo.svg'
                    alt='Status Kitchen Logo'
                    class='w-8 h-8'
                />
                <span class='font-bold text-lg tracking-tight lg:block'
                    >Status Kitchen</span
                >
            </a>

            <!-- Mobile Toggle -->
            <button
                id='mobile-menu-btn'
                class='md:hidden p-2 flex items-center justify-center text-cast-iron dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors'
            >
                <i class='ph ph-list text-2xl' id='menu-icon'></i>
                <i class='ph ph-x text-2xl hidden' id='close-icon'></i>
            </button>
        </div>

        <!-- Desktop Links -->
        <div class='hidden md:flex items-center gap-1'>
            <Button
                href='#features'
                variant='ghost'
                class='!px-3 !py-2 text-cast-iron dark:text-white'
                >Features</Button
            >
            <Button
                href='https://docs.statuskitchen.app'
                external
                variant='ghost'
                class='!px-3 !py-2 text-cast-iron dark:text-white'
            >
                <span class='flex items-center gap-2'>
                    Docs <i class='ph ph-arrow-up-right text-xs opacity-50'></i>
                </span>
            </Button>
            <Button
                href='https://cookbook.statuskitchen.app'
                external
                variant='ghost'
                class='!px-3 !py-2 text-cast-iron dark:text-white'
            >
                <span class='flex items-center gap-2'>
                    Cookbook <i class='ph ph-arrow-up-right text-xs opacity-50'
                    ></i>
                </span>
            </Button>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div
            id='mobile-menu'
            class='hidden md:hidden flex-col gap-2 pt-2 pb-2 w-full min-w-[200px]'
        >
            <hr class='border-black/5 dark:border-white/5 mx-2 mb-2' />
            <Button
                href='#features'
                variant='ghost'
                class='w-full !justify-start !px-4 text-cast-iron dark:text-white'
                >Features</Button
            >
            <Button
                href='https://docs.statuskitchen.app'
                external
                variant='ghost'
                class='w-full !justify-start !px-4 text-cast-iron dark:text-white'
            >
                <span class='flex items-center gap-2'>
                    Docs <i class='ph ph-arrow-up-right text-xs opacity-50'></i>
                </span>
            </Button>
            <Button
                href='https://cookbook.statuskitchen.app'
                external
                variant='ghost'
                class='w-full !justify-start !px-4 text-cast-iron dark:text-white'
            >
                <span class='flex items-center gap-2'>
                    Cookbook <i class='ph ph-arrow-up-right text-xs opacity-50'
                    ></i>
                </span>
            </Button>
            <div class='h-2'></div>
            <Button
                href='#download'
                variant='primary'
                class='w-full !justify-center'
            >
                <i class='ph-bold ph-download-simple mr-2'></i> Install
            </Button>

            <div class='h-2'></div>

            <button
                id='theme-toggle-mobile'
                class='w-full p-3 flex items-center justify-center gap-2 text-cast-iron dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors'
            >
                <span class='dark:hidden flex items-center gap-2'
                    ><i class='ph ph-moon text-xl'></i> Dark Mode</span
                >
                <span class='hidden dark:flex items-center gap-2'
                    ><i class='ph ph-sun text-xl'></i> Light Mode</span
                >
            </button>
        </div>

        <!-- Desktop CTA -->
        <div class='hidden md:flex items-center gap-2'>
            <button
                id='theme-toggle'
                class='p-2 text-cast-iron dark:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors'
                aria-label='Toggle Theme'
            >
                <i class='ph ph-sun text-xl hidden dark:block'></i>
                <i class='ph ph-moon text-xl block dark:hidden'></i>
            </button>
            <Button
                href='#download'
                variant='primary'
                class='!px-4 !py-2 whitespace-nowrap'
            >
                <i class='ph-bold ph-download-simple mr-2'></i> Install
            </Button>
        </div>
    </div>
</nav>

<script>
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    // Theme Toggle Logic
    const themeToggleBtn = document.getElementById('theme-toggle');

    function setTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            document.documentElement.classList.remove('light');
        } else {
            document.documentElement.classList.remove('dark');
            document.documentElement.classList.add('light');
        }
        localStorage.setItem('theme', theme);
    }

    // Initialize theme
    const savedTheme = localStorage.getItem('theme');
    const systemDark = window.matchMedia(
        '(prefers-color-scheme: dark)'
    ).matches;

    if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
        document.documentElement.classList.add('dark');
        document.documentElement.classList.remove('light');
    } else {
        document.documentElement.classList.remove('dark');
        document.documentElement.classList.add('light');
    }

    // Toggle click handler
    themeToggleBtn?.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        setTheme(isDark ? 'light' : 'dark');
    });

    const mobileThemeToggleBtn = document.getElementById('theme-toggle-mobile');
    mobileThemeToggleBtn?.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        setTheme(isDark ? 'light' : 'dark');
    });

    // Mobile Menu Logic
    menuBtn?.addEventListener('click', () => {
        const isHidden = mobileMenu?.classList.contains('hidden');

        if (isHidden) {
            mobileMenu?.classList.remove('hidden');
            mobileMenu?.classList.add('flex');
            menuIcon?.classList.add('hidden');
            closeIcon?.classList.remove('hidden');
        } else {
            mobileMenu?.classList.add('hidden');
            mobileMenu?.classList.remove('flex');
            menuIcon?.classList.remove('hidden');
            closeIcon?.classList.add('hidden');
        }
    });

    // Close menu when clicking a link
    mobileMenu?.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => {
            mobileMenu?.classList.add('hidden');
            mobileMenu?.classList.remove('flex');
            menuIcon?.classList.remove('hidden');
            closeIcon?.classList.add('hidden');
        });
    });
</script>
